{# Modal content for field changes (update/association_change) - accordion view #}
<div class="accordion" id="accordionAudit{{ entryId }}">
    {% set changeIndex = 0 %}
    {% for key, value in diffs %}
        {% if key not in ['@source', '@context'] and value is iterable %}
            {% set changeIndex = changeIndex + 1 %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ entryId }}_{{ changeIndex }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ entryId }}_{{ changeIndex }}" aria-expanded="false" aria-controls="collapse{{ entryId }}_{{ changeIndex }}">
                        {{ key }}
                        <div class="d-flex justify-content-between ms-auto">
                            {% if value.old is defined and value.new is defined %}
                                <span class="badge bg-secondary">
                                    {{ value.old|json_encode|slice(0, 20) }}
                                </span>
                                <span class="material-icons ms-3">east</span>
                                <span class="badge bg-secondary ms-3">
                                    {{ value.new|json_encode|slice(0, 20) }}
                                </span>
                            {% elseif value.removed is defined and value.added is defined %}
                                <span class="badge bg-danger">- {{ value.removed|length }}</span>
                                <span class="badge bg-success ms-3">+ {{ value.added|length }}</span>
                            {% endif %}
                        </div>
                    </button>
                </h2>
                <div id="collapse{{ entryId }}_{{ changeIndex }}" class="accordion-collapse collapse" aria-labelledby="heading{{ entryId }}_{{ changeIndex }}" data-bs-parent="#accordionAudit{{ entryId }}">
                    <div class="accordion-body">
                        {% if value.old is defined %}
                            <div class="row">
                                <div class="col-6">
                                    <label class="fw-bold">Old value</label>
                                    <pre class="bg-light p-2 rounded overflow-auto" style="max-height: 300px;"><code>{{ value.old|default('N/A')|json_encode(constant('JSON_PRETTY_PRINT')) }}</code></pre>
                                </div>
                                <div class="col-6">
                                    <label class="fw-bold">New value</label>
                                    <pre class="bg-light p-2 rounded overflow-auto" style="max-height: 300px;"><code>{{ value.new|default('N/A')|json_encode(constant('JSON_PRETTY_PRINT')) }}</code></pre>
                                </div>
                            </div>
                        {% elseif value.removed is defined %}
                            <div class="row">
                                <div class="col-6">
                                    <label class="fw-bold">Removed</label>
                                    <ul class="list-unstyled">
                                        {% for item in value.removed %}
                                            <li class="text-nowrap overflow-auto"><code>{{ item|json_encode }}</code></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <div class="col-6">
                                    <label class="fw-bold">Added</label>
                                    <ul class="list-unstyled">
                                        {% for item in value.added %}
                                            <li class="text-nowrap overflow-auto"><code>{{ item|json_encode }}</code></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
</div>
